<!DOCTYPE html>
<html style="height: 100%;">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

	<title>Using ValueConverter and MultiValueConverter in WPF - CodeProject</title> 
	


	

<meta name="Description" content="Sample WPF value and multivalue converters for entering unit based values.; Author: Dirkster99; Updated: 11 Jun 2012; Section: Windows Presentation Foundation; Chapter: Platforms, Frameworks &amp; Libraries; Updated: 11 Jun 2012">
<meta name="Keywords" content=".NET3.5, Architect, Dev, XAML, WPF, Design, Intermediate, C#3.5, Model, view,Windows Presentation Foundation,Platforms, Frameworks &amp; Libraries,Free source code, tutorials">
<meta name="Author" content="Dirkster99">
<meta name="Rating" content="General">
<meta name="Robots" content="index, follow, NOODP">
<meta name="Revisit-After" content="1 days">
<meta name="application-name" content="CodeProject">
<meta name="google-translate-customization" content="d908bb7ce7aff658-4c2f3a504525c916-g629383f736781a8a-13">

<link rel="dns-prefetch" href="http://ajax.googleapis.com/"> 
<link rel="canonical" href="http://www.codeproject.com/Articles/298950/Using-ValueConverter-and-MultiValueConverter-in-WP">


<link rel="alternate" type="application/rss+xml" title="CodeProject Latest articles - All Topics" href="http://www.codeproject.com/WebServices/ArticleRSS.aspx?cat=1">
<link rel="alternate" type="application/rss+xml" title="CodeProject Latest articles - Android" href="http://www.codeproject.com/WebServices/ArticleRSS.aspx?cat=22">
<link rel="alternate" type="application/rss+xml" title="CodeProject Latest articles - iOS" href="http://www.codeproject.com/WebServices/ArticleRSS.aspx?cat=25">
<link rel="alternate" type="application/rss+xml" title="CodeProject Latest articles - C++" href="http://www.codeproject.com/WebServices/ArticleRSS.aspx?cat=2">
<link rel="alternate" type="application/rss+xml" title="CodeProject Latest articles - C#" href="http://www.codeproject.com/WebServices/ArticleRSS.aspx?cat=3">
<link rel="alternate" type="application/rss+xml" title="CodeProject Latest articles - Web" href="http://www.codeproject.com/WebServices/ArticleRSS.aspx?cat=23">
<link rel="alternate" type="application/rss+xml" title="CodeProject Lounge Postings" href="http://www.codeproject.com/webservices/LoungeRSS.aspx">
<link rel="search" type="application/opensearchdescription+xml" title="CodeProject" href="http://www.codeproject.com/info/OpenSearch.xml">

	<base target="_top">
	<link rel="icon" href="favicon.ico" type="image/ico">
<link rel="shortcut icon" href="favicon.ico" type="image/ico">
<link rel="apple-touch-icon" href="http://www.codeproject.com/images/FavIcon-Apple.png" type="image/png">


	








<link rel="stylesheet" type="text/css" href="index.css" media="all">
</head>
<body style="position: relative; min-height: 100%; top: 0px;" class="firefox firefox23">

<a class="access-link" href="#Main"><img alt="Click here to Skip to main content" src="t.gif"></a>





<div class="page-background">

	
	

	

	<table id="ctl00_Bn" style="width: 100%; height: 135px;" class="banner fluid" cellpadding="0" cellspacing="0">
	<tbody><tr valign="bottom">
		<td class="blank-background" style="height: 31px;">&nbsp;</td>
		<td class="blank-background" rowspan="3" style="width: 250px; height: 135px;"><a href="http://www.codeproject.com/"><img id="ctl00_Logo" tabindex="1" title="CodeProject" src="logo250x135.gif" alt="Home" style="height: 135px; width: 250px; border-width: 0px;"></a></td>
		<td class="blank-background align-right" style="width: 728px; height: 31px;"></td>
		<td class="blank-background" style="height: 31px;">&nbsp;</td>
	</tr>
	<tr valign="middle">
		<td class="theme1-background" style="height: 94px;">&nbsp;</td>
		<td class="theme1-background ad"></td>
		<td class="theme1-background" style="height: 94px;">&nbsp;</td>
	</tr>
	<tr valign="top">
		<td style="height: 14px;"></td>
		<td style="height: 14px;" class="blank-background"></td>
		<td style="height: 14px;"></td>
	</tr>
</tbody></table>


	<a href="#Main"><img alt="Click here to Skip to main content" class="access-link" src="t.gif"></a>

	
	
	

	<div id="A" class="container-content-wrap fluid print"> 

	<div itemscope="" itemtype="http://schema.org/Article" class="container-content"> 

		<div class="clearfix">
			<div class="float-left container-breadcrumb">
				<div><a href="http://www.codeproject.com/script/Content/SiteMap.aspx">Articles</a> » <a href="http://www.codeproject.com/Chapters/8/Platforms-Frameworks-Libraries.aspx">Platforms, Frameworks &amp; Libraries</a> » <a href="http://www.codeproject.com/KB/WPF/"><span itemprop="articleSection">Windows Presentation Foundation</span></a> » <a href="http://www.codeproject.com/KB/WPF/#XAML">XAML</a></div>
			</div>

			<div class="align-left float-right padded-top" style="width">
				
			</div>

			<div class="float-right article-nav">
				
				
			</div>

			<div class="align-right float-left">
				
			</div>
		</div>

		<table class="extended container-article-parts" cellpadding="0" cellspacing="0">
        <tbody><tr valign="top">
		<td width="117px">

			

		</td>
		<td>
			
			<div id="AT" class="container-article  fluid tight"> 
				<div class="article">

					<form name="aspnetForm" method="post" action="http://www.codeproject.com/Articles/298950/Using-ValueConverter-and-MultiValueConverter-in-WP?display=Print" id="aspnetForm" style="margin: 0px; padding: 0px;">
<div>
<input name="__VIEWSTATE" id="__VIEWSTATE" value="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" type="hidden">
</div>

<div>

	<input name="__VIEWSTATEGENERATOR" id="__VIEWSTATEGENERATOR" value="10C1FD69" type="hidden">
</div>

					
					 
					<div class="header">
					    <a name="Main"></a>

					    
					    <a name="_articleTop" id="_articleTop"></a>
					    <div class="title">
					        
					        <h1 id="ctl00_ArticleTitle" itemprop="name">Using ValueConverter and MultiValueConverter in WPF</h1> 
					    </div>

                        <div style="height: 34px;">
					        
					        <div class="entry float-left">
                                
                                <div class="float-left">

						            <span class="author"><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=7799028" rel="author"><span itemprop="author" itemscope="" itemtype="http://schema.org/Person"><span itemprop="name">Dirkster99</span></span></a></span>, 
						            <span class="date" itemprop="dateModified" content="2012-06-11 16:09:00">
							            11 Jun 2012</span>
			
                                    <a id="ctl00_LicenseLink" title="The Code Project Open License (CPOL)" class="license" href="http://www.codeproject.com/info/cpol10.aspx">CPOL</a><div id="ctl00_CurRat" class="tooltip anchorLink" style="cursor: pointer; margin-top: 5px;">
				
							            

<table class="small-text" itemprop="aggregateRating" itemscope="" itemtype="http://schema.org/AggregateRating" cellpadding="0" cellspacing="0"> 
<tbody><tr>
	
	<td class="nowrap">

		
			<meta itemprop="bestRating" content="5"> 
			<meta itemprop="worstRating" content="1">
		

		<span id="ctl00_ArticleRating_VI">
		<div class="nowrap rating-stars-large" style="height: 21px; width: 119px; position: relative;">
	<div class="clipped align-left float-left" style="height: 19px; width: 100px;">
		<img src="stars-fill-lg.png" style="border-width: 0px;">
	</div><div class="clipped" style="height: 19px; width: 19px; position: relative;">
		<img src="stars-empty-lg.png" style="border-width: 0px; position: absolute; top: 0px; right: 0px;">
	</div>
</div>
		</span>

		
	</td>
	
	<td id="ctl00_ArticleRating_VR" class="nowrap">
		&nbsp;
		<span id="ctl00_ArticleRating_VotesR">&nbsp;<span itemprop="ratingValue" class="rating">4.00</span> (<span itemprop="ratingCount" class="count">3</span> votes)</span>
		
	</td>

</tr>

</tbody></table>


							            <div id="ctl00_RB" class="speech-bubble-container-up">
								            <div class="speech-bubble-up" style="width: 150px ! important;">
									                        
<div>
<table class="feature" title="Voting Distribution. Recent data only" cellpadding="0" cellspacing="0" height="20px" width="100%"><tbody><tr class="chart-row"><td class="chart-column"><span title="0 votes">1</span></td>
<td class="chart-column"><span title="0 votes">2</span></td>
<td class="chart-column"><span title="0 votes">3</span></td>
<td class="chart-column"><div><img src="pollcol.gif" alt="3 votes, 100.0%" title="3 votes, 100.0%" border="0px" height="20px" width="20pxpx"></div><span title="3 votes">4</span></td>
<td class="chart-column"><span title="0 votes">5</span></td>
</tr></tbody></table><div class="small-text align-center">4.00/5 - 3 votes</div><div class="small-text align-center subdue">μ 4.00, σ<sub>a</sub> 1.10 [<a href="http://www.codeproject.com/KB/FAQs/RatingReputationFAQ.aspx#noisefilter">?</a>]</div>
</div>
								            </div>
								            <div class="speech-bubble-pointer-up">
									            <div class="speech-bubble-pointer-up-inner"></div>
								            </div>
							            </div>
						            </div>
                                </div>
					        </div>

                            
						    
						    	

						    	
                            <div class="float-right" style="margin: 4px 20px 0px 0px;">
						        
                            </div>                    
						    	
                        </div>

   					    
                        <div id="ctl00_description" class="summary">Sample WPF value and multivalue converters for entering unit based values.</div>			

                    </div>
                    
					
					

					

					
					
					

						
					

					

						
						<div id="contentdiv" class="text" itemprop="articleBody">
						



<ul class="download">
<li><a href="filesize_converter_test.zip">Download source code - 42.7 KB</a></li>
</ul>
<h2>Introduction</h2>
<p>The Windows Presentation Foundation (WPF) in C# contains a few technologies and interfaces to link <em>eahm</em> bind controls and properties to each other. Users can enter 
a value and make it (or some feedback of it) appear somewhere in the GUI. This article presents a way of checking for valid input values 
via <code>ValueConverter</code> and <code>MultiValueConverter</code> in XAML.</p>
<h2>Background</h2>
<p>The background of this article is an application that uses <em><a title="http://dotnetzip.codeplex.com/" href="http://dotnetzip.codeplex.com/">Ionic</a></em> 
zip file handling with the file splitting or file spanning feature. This feature lets the user create a series of zip files where each file has roughly the same size. 
A user can, for example, create a series of 5 files, each having a maximum size of 100MB. This can be useful if the total size of files can be very large 
but if there is an upper bound for the size of individual files.</p>
<p>The upper bound-file spanning/file size problem arises when someone wants to store the zipped file on a media with limited size (e.g.: USB stick), or if the compressed 
data size exceeds 2GB (on Windows XP) or 4GB (on Vista/Windows 7).</p>
<p>This article showcases one way to solve this problem in a flexible manner. The user can enter memory sizes in any unit he wants (e.g.: xxx bytes, KB, MB, GB, TB, or PB) 
and the software verifies whether the entered data is valid in terms of the syntax and the actual value (in between a range).</p>
<p>The valid memory range in my sample test application is set to anything between 100MB and 4GB (including these values) as can be seen in Figures 1 and 2.</p>
<p><img src="testwindow.png" height="429" width="600"></p>
<div class="Caption">Figure 1: A sample screenshot of the TestWindow in the included test application</div>
<p><img src="testdialog.png"></p>
<div class="Caption">Figure 2: A sample screenshot of the TestDialog in the included test application</div>
<p>The outputs in Figures 1 and 2 show different development stages in which entered values are converted and displayed with different feedbacks.</p>
<p>The TestWindow in Figure 1 shows the first development step where a user can enter a string like "100GB" or "1024 KB" and the program converts 
this string into a bytes value in the <code>TextBlock</code> just below the main input <code>TextBox</code> control. The second <code>TextBlock</code> 
with the <em>appropriate unit</em> (below the first <code>TextBlock</code>) shows a converter output from the first <em>bytes</em> <code>TextBlock</code>. 
The aim of these two outputs is to visualize the conversion results as a user types and re-types values.</p>
<p>The first output was needed, because checking whether a value is inside a given range requires conversion to a value of the smallest possible unit (that is bytes in this case). 
And the second label was useful because a user should not have to read a message like: "Please select a value smaller than 10048 MB" when the upper bound was exceeded. 
Therefore, an appropriate size converison is required for output purposes.</p>
<p>But we are getting ahead of ourselves. Let us look at the project and develop the solution from bottom to top.</p>
<h2>Using the code</h2>
<h3>StyleCop</h3>
<p>I use <a title="http://stylecop.codeplex.com/" href="http://stylecop.codeplex.com/" target="_top">StyleCop</a> in my projects to make the code readable in a uniform 
way. So, you can either download and install StyleCop, or edit/remove the corresponding entries in each <em>.csproj</em> file, should you get an error when compiling the project:</p>
<pre lang="xml"><span class="code-keyword">&lt;</span><span class="code-leadattribute">Import</span> <span class="code-attribute">Project</span><span class="code-keyword">="</span><span class="code-keyword">$(ProgramFiles)\MSBuild\StyleCop\v4.5\StyleCop.Targets"</span> <span class="code-keyword">/</span><span class="code-keyword">&gt;</span> </pre>
<h3>Project structure</h3>
<p>The image in Figure 3 shows the rough structure of the project. There is a <em>FileSize_Converter_Test</em> project and a <em>FSControls</em> project. 
The former project is what we need to <em>Set as Startup Project</em> in Visual Studio if we want to test the FSControls functionality. 
The <em>FSControls</em> library contains the parser and converter functions documented in this article. This DLL can be included and consumed in other projects.</p>
<p><img src="solutionexplorer.png" height="437" width="308"></p>
<div class="Caption">Figure 3: The project structure of the submitted source code</div>
<p>The core of the <em>FSControls</em> project are the <code>FileSizeContext</code>, <code>FileSizeExpression</code>, <code>FileSizeParser</code>, 
and <code>TemrinalFileSizeExpression</code> classes.</p>
<p>The<code> FileSizeExpression</code> class defines the fundamentals of each class that represents a unit. Each of the classes:</p>
<ul>
<li><code>BytesFileSizeExpression</code></li>
<li><code>KbFileSizeExpression</code></li>
<li><code>MbFileSizeExpression</code></li>
<li><code>GbFileSizeExpression</code></li>
<li><code>TbFileSizeExpression</code></li>
</ul>
<p>derived from <code>TerminalFileSizeExpression</code> in the <code>FileSizeContext</code> class, represents a corresponding unit (bytes, KB, MB, GB...) of memory sizes.</p>
<p>The <code>ConvertUnparsedSizeToBytesInt</code> function in the <code>FileSizeContext</code> class can be used to check whether conversion of a string containing 
something like "100MB", "10 bytes", or "1024 GB" into an <code>int</code> number of bytes can be successful or not. Review this function 
if you want to have a simple reference for the required conversion process.</p>
<pre lang="cs"><span class="code-keyword">public</span> <span class="code-keyword">static</span> <span class="code-keyword">bool</span> ConvertUnparsedSizeToBytesInt(<span class="code-keyword">object</span> value,
                                                     <span class="code-keyword">out</span> <span class="code-keyword">ulong</span> numberOfBytes,
                                                     <span class="code-keyword">out</span> <span class="code-keyword">string</span>[] sInputComponents)</pre>
<p>The <code>TerminalFileSizeExpression</code> class derives from the <code>FileSizeContext</code> class and defines the <code>Interpret</code> method. 
The <code>Interpret</code> method checks if <code>ThisPattern</code> of the current class (e.g.: "GB") can be matched to the end of the string, 
and converts the value into the <code>NextPattern</code> of that class (e.g.: "MB"), if that was the case.</p>
<p>The <code>FileSizeParser</code> class is also derived from the <code>TerminalFileSizeExpression</code> class and overrides its own version 
of the <code>Interpret</code> method. In this method, we cycle through each unit (form top "TB" to bottom "bytes") and convert 
"down to next unit" if the current unit was matched with the input string stored in the <code>value</code> object:</p>
<pre lang="cs"><span class="code-keyword">public</span> <span class="code-keyword">override</span> <span class="code-keyword">void</span> Interpret(FileSizeContext value, <span class="code-keyword">out</span> <span class="code-keyword">string</span>[] strComponents)
{
  strComponents = <span class="code-keyword">null</span>;

  <span class="code-comment">//</span><span class="code-comment"> Go through each defined expression and see if we can match it with a known unit
</span>  <span class="code-comment">//</span><span class="code-comment"> Compute next smaller unit (eg. convert from Gb to Mb) and keep going until we
</span>  <span class="code-comment">//</span><span class="code-comment"> hit bytes
</span>  <span class="code-keyword">foreach</span> (FileSizeExpression exp <span class="code-keyword">in</span> <span class="code-keyword">this</span>.expressionTree)
  {
    <span class="code-keyword">string</span>[] strOutComponents = <span class="code-keyword">null</span>;
      
    <span class="code-comment">//</span><span class="code-comment"> Adjust value to next smaller unit (if any)
</span>    exp.Interpret(value, <span class="code-keyword">out</span> strOutComponents);

    <span class="code-comment">//</span><span class="code-comment"> Found a match and converted OK -&gt; Return to sender
</span>    <span class="code-keyword">if</span> (exp.InterpretOK == <span class="code-keyword">true</span>)
    {
      <span class="code-comment">//</span><span class="code-comment"> return recognized and cleaned string components from input
</span>      <span class="code-keyword">if</span> (<span class="code-keyword">this</span>.InterpretOK == <span class="code-keyword">false</span>)
        strComponents = strOutComponents;

      <span class="code-keyword">this</span>.InterpretOK = <span class="code-keyword">true</span>;
    }
  }

  <span class="code-comment">//</span><span class="code-comment"> Attempt 'bytes conversion' as last resort
</span>  <span class="code-keyword">if</span> (<span class="code-keyword">this</span>.InterpretOK == <span class="code-keyword">false</span>)
    <span class="code-keyword">this</span>.InterpretAsBytes(value);
}</pre>
<p>The call to the <code>InterpretAsBytes</code> method is needed because a user might enter "1000 bytes" and we would like to work with that input. 
In this case, a "down" conversion is not possible but the input is still valid so we use this method to resolve that input.</p>
<h2>Converter</h2>
<p>Normally, converters live in a resource in a <code>Window</code> (or <code>UserControl</code>) and are referenced via their <code>x:key</code> property:</p>
<pre lang="xml"><span class="code-keyword">&lt;</span><span class="code-leadattribute">Window.Resources</span><span class="code-keyword">&gt;</span>
  <span class="code-keyword">&lt;</span><span class="code-leadattribute">local:NumberToBestSizeConverter2</span> <span class="code-attribute">x:Key</span><span class="code-keyword">="</span><span class="code-keyword">MyConverter"</span> <span class="code-keyword">/</span><span class="code-keyword">&gt;</span>
<span class="code-keyword">&lt;</span><span class="code-keyword">/</span><span class="code-leadattribute">Window.Resources</span><span class="code-keyword">&gt;</span></pre>
<p>But this gets tedious pretty soon as one starts using a few converters. This implementation is based on an alternative scenario where converters are derived from 
the <code>MarkupExtension</code> class. This derivation allows us to use the resulting converters directly in the XAML (without explicit reference to an existing resource).</p>
<h3>IValueConverter</h3>
<p>Samples of <code>IValueConverter</code> implementations can be found in the <em>FSControls/FileSize/Converter</em> 
package. Each file in this package contains two classes, an <code>IValueConverter</code> and 
an <code>IMultiValueConverter</code> (see next section) implementation for the same purpose of conversion.</p>
<p>The <code>IValueConverter</code> interface appears complicated and difficult to understand at first sight. But its purpose is really just to take an input value 
and convert it into an output value. This is probably best verified if you insert a breakpoint at the beginning of the <code>Convert</code> function and step through 
it when it is used from within the XAML discussed below.</p>
<p>The <code>IValueConverter</code> in the <code>NumberToBestSizeConverter</code> class converts, for instance, a simple string like "1024 KB" into a human 
readable output string "1 MB". The <code>NumberToBestSizeConverter2</code> class does the same but it also accepts an optional parameter (an <code>array[2]</code> 
of type <code>ulong</code>) to determine whether the entered value is within the Min-Max range of the supplied array.</p>
<h3>IMultiValueConverter</h3>
<p>An <code>IMultiValueConverter</code> is really just an <code>IValueConverter</code> that accepts an array of objects as input and outputs a converted object.</p>
<p>The <code>NumberToBestSizeConverter3</code> class does a similar job as the <code>NumberToBestSizeConverter2</code> class, except it prints an output value only, 
if there is a syntax error, or if the suggested human read-able string does in fact differ from the input string.</p>
<p>This is used in the <code>TestDialog</code> class (see further below) to visualize a feedback only:</p>
<ul>
<li>if something's wrong, or</li>
<li>if the user actually entered "100000 bytes" hoping that the software would tell him how many GBs this might be.</li>
</ul>
<p>The <code>NumberToBestSizeConverter3</code> class is derived from <code>IMultiValueConverter</code> to accept an array of input objects. 
This was required to support the selection of a unit via combobox and the input of the value via textbox.</p>
<h2>TestWindow</h2>
<p>Review the XAML in the <code>TestWindow</code> class to understand how the input string from the textbox is converted into a bytes representation (<code>NumberToSizeConverter</code>) 
and from there into a "BestSize" representation (<code>NumberToBestSizeConverter</code>). Take a note of the <code>Window.Resources</code> tag:</p>
<pre lang="xml"><span class="code-keyword">&lt;</span><span class="code-leadattribute">Window.Resources</span><span class="code-keyword">&gt;</span>
  <span class="code-keyword">&lt;</span><span class="code-leadattribute">x:Array</span> <span class="code-attribute">Type</span><span class="code-keyword">="</span><span class="code-keyword">{x:Type sys:UInt64}"</span> <span class="code-attribute">x:Key</span><span class="code-keyword">="</span><span class="code-keyword">MinMaxValues"</span><span class="code-keyword">&gt;</span>
    <span class="code-keyword">&lt;</span><span class="code-leadattribute">sys:UInt64</span><span class="code-keyword">&gt;</span>209715200<span class="code-keyword">&lt;</span><span class="code-keyword">/</span><span class="code-leadattribute">sys:UInt64</span><span class="code-keyword">&gt;</span><span class="code-comment">&lt;!--</span><span class="code-keyword"><span class="code-comment"> Minimum is 200Mb</span>--&gt;</span>
    <span class="code-keyword">&lt;</span><span class="code-leadattribute">sys:UInt64</span><span class="code-keyword">&gt;</span>4294967296<span class="code-keyword">&lt;</span><span class="code-keyword">/</span><span class="code-leadattribute">sys:UInt64</span><span class="code-keyword">&gt;</span><span class="code-comment">&lt;!--</span><span class="code-keyword"><span class="code-comment"> Maximum 4Gb </span>--&gt;</span>
  <span class="code-keyword">&lt;</span><span class="code-keyword">/</span><span class="code-leadattribute">x:Array</span><span class="code-keyword">&gt;</span>
<span class="code-keyword">&lt;</span><span class="code-keyword">/</span><span class="code-leadattribute">Window.Resources</span><span class="code-keyword">&gt;</span></pre>
<p>This array of <code>UInt64</code> objects is used to determine the range of acceptable values via <code>ConverterParameter</code> of the corresponding 
<code>Converter</code> binding statements. For example, like so:</p>
<pre lang="xml"><span class="code-keyword">&lt;</span><span class="code-leadattribute">TextBox</span> <span class="code-attribute">x:Name</span><span class="code-keyword">="</span><span class="code-keyword">txtBytes"</span>
          <span class="code-attribute">IsReadOnly</span><span class="code-keyword">="</span><span class="code-keyword">True"</span> <span class="code-attribute">BorderThickness</span><span class="code-keyword">="</span><span class="code-keyword">0"</span> <span class="code-attribute">Margin</span><span class="code-keyword">="</span><span class="code-keyword">3"</span>
          <span class="code-attribute">Grid.Column</span><span class="code-keyword">="</span><span class="code-keyword">1"</span> <span class="code-attribute">Grid.Row</span><span class="code-keyword">="</span><span class="code-keyword">1"</span> <span class="code-attribute">HorizontalAlignment</span><span class="code-keyword">="</span><span class="code-keyword">Left"</span> <span class="code-attribute">Width</span><span class="code-keyword">="</span><span class="code-keyword">350"</span><span class="code-keyword">&gt;</span>
  <span class="code-keyword">&lt;</span><span class="code-leadattribute">TextBox.Text</span><span class="code-keyword">&gt;</span>
    <span class="code-keyword">&lt;</span><span class="code-leadattribute">Binding</span> <span class="code-attribute">ElementName</span><span class="code-keyword">="</span><span class="code-keyword">txtInput"</span> <span class="code-attribute">Path</span><span class="code-keyword">="</span><span class="code-keyword">Text"</span> <span class="code-attribute">Converter</span><span class="code-keyword">="</span><span class="code-keyword">{local:NumberToSizeConverter}"</span>
             <span class="code-attribute">ConverterParameter</span><span class="code-keyword">="</span><span class="code-keyword">{StaticResource MinMaxValues}"</span> <span class="code-keyword">/</span><span class="code-keyword">&gt;</span>
  <span class="code-keyword">&lt;</span><span class="code-keyword">/</span><span class="code-leadattribute">TextBox.Text</span><span class="code-keyword">&gt;</span>
<span class="code-keyword">&lt;</span><span class="code-keyword">/</span><span class="code-leadattribute">TextBox</span><span class="code-keyword">&gt;</span></pre>
<p>Notice the converter attached to the <code>IsEnabled</code> property of the <em>Test Click</em> button. It makes sure the button is clickable 
only if the entered value is valid and within the defined range.</p>
<p>There is really not much more to say here. Just set a breakpoint in the corresponding convert function of any converter and debug the application, if you are 
in doubt of the bindings and all the other mumbo-jumbo here.</p>
<h2>TestDialog</h2>
<p>The <code>TestDialog</code> class is the second approach on the subject and it features some more advanced items, such as:</p>
<ul>
<li>a ViewModel (<code>ProgrammOptionsVM</code>) to bind to,</li>
<li>a combobox to enter the size of memory unit with,</li>
<li>an image that pops-up whenever there is an input error,</li>
<li>a label that shows only if the "BestSize" differs from input or if there is an error,</li>
<li>and an OK button that enables only if the entered value is OK.</li>
</ul>
<p>While all these things might be confusing at first, they are mostly based on different converters, which in turn rely on the objects defined 
in the <code>Window.Resources</code> tag in the <em>TestDialog.xaml</em> file.</p>
<p>Here is the sample XAML that controls whether an error image is shown or not:</p>
<pre lang="xml"><span class="code-keyword">&lt;</span><span class="code-leadattribute">Image</span> <span class="code-attribute">Source</span><span class="code-keyword">="</span><span class="code-keyword">/FileSize_Converter_Test;component/icons/error.png"</span>
           <span class="code-attribute">Width</span><span class="code-keyword">="</span><span class="code-keyword">32"</span> <span class="code-attribute">Height</span><span class="code-keyword">="</span><span class="code-keyword">32"</span> <span class="code-attribute">Grid.Column</span><span class="code-keyword">="</span><span class="code-keyword">0"</span> <span class="code-attribute">Grid.Row</span><span class="code-keyword">="</span><span class="code-keyword">2"</span>
           <span class="code-attribute">HorizontalAlignment</span><span class="code-keyword">="</span><span class="code-keyword">Right"</span> <span class="code-attribute">VerticalAlignment</span><span class="code-keyword">="</span><span class="code-keyword">Center"</span><span class="code-keyword">&gt;</span>
  <span class="code-keyword">&lt;</span><span class="code-leadattribute">Image.Visibility</span><span class="code-keyword">&gt;</span>
    <span class="code-keyword">&lt;</span><span class="code-leadattribute">MultiBinding</span> <span class="code-attribute">Converter</span><span class="code-keyword">="</span><span class="code-keyword">{local:SizeNumberToErrorVisibilityConverter2}"</span>
                  <span class="code-attribute">ConverterParameter</span><span class="code-keyword">="</span><span class="code-keyword">{StaticResource MockupMinMaxValues}"</span>
                  <span class="code-attribute">Mode</span><span class="code-keyword">="</span><span class="code-keyword">OneWay"</span><span class="code-keyword">&gt;</span>
      <span class="code-keyword">&lt;</span><span class="code-leadattribute">Binding</span> <span class="code-attribute">ElementName</span><span class="code-keyword">="</span><span class="code-keyword">txtInput"</span> <span class="code-attribute">Path</span><span class="code-keyword">="</span><span class="code-keyword">Text"</span><span class="code-keyword">/</span><span class="code-keyword">&gt;</span>
      <span class="code-keyword">&lt;</span><span class="code-leadattribute">Binding</span> <span class="code-attribute">ElementName</span><span class="code-keyword">="</span><span class="code-keyword">cmdMemUnits"</span> <span class="code-attribute">Path</span><span class="code-keyword">="</span><span class="code-keyword">SelectedItem.Value.Value"</span> <span class="code-keyword">/</span><span class="code-keyword">&gt;</span>
    <span class="code-keyword">&lt;</span><span class="code-keyword">/</span><span class="code-leadattribute">MultiBinding</span><span class="code-keyword">&gt;</span>
  <span class="code-keyword">&lt;</span><span class="code-keyword">/</span><span class="code-leadattribute">Image.Visibility</span><span class="code-keyword">&gt;</span>
<span class="code-keyword">&lt;</span><span class="code-keyword">/</span><span class="code-leadattribute">Image</span><span class="code-keyword">&gt;</span></pre>
<p>The visibility property is bound to a MultiValue converter <code>SizeNumberToErrorVisibilityConverter2</code>. The converter gets its parameters from 
the <code>MockupMinMaxValues</code> array of <code>UInt64</code> values. The actual <code>object[]</code> values to be converted are supplied from the textbox (<code>txtInput</code>) 
and the combobox (<code><code>cmdMemUnits</code></code>).</p><p>Take a note of the <code>btnTestWindow1_Click</code> method in the <em>TestWindow.xaml.cs</em> file. 
This method shows how the 'Mockup' Windows resources are overwritten (with real objects and their values) at runtime.</p>
<p>The <code>ProgramOptionsVM</code> ViewModel does not have a model. Normally, one would design a model class, for example, <code>ProgramOptions</code>, that would contain 
only the properties for <code>selectedMemUnit</code> and <code>selectedSize</code>. This way, that model can be persisted and processed without direct dependency 
on the view. But this is omitted in favour of simplification. Instead the trace to the "model" ends in the fields of the <code>ProgramOptionsVM</code> class:</p>
<pre lang="cs"><span class="code-keyword">private</span> <span class="code-keyword">readonly</span> Dictionary&lt;MemUnit, UIList&gt; mMemUnits;
<span class="code-keyword">private</span> MemUnit selectedMemUnit;
<span class="code-keyword">private</span> <span class="code-keyword">double</span> selectedSize;</pre>
<p>The above fields are then exposed and bound to the <em>TestDialog.xaml</em> controls via their corresponding properties.</p>
<h2>Points of interest</h2>
<p>This project gave me a huge inside on how converters and ViewModels are related to each other and how we can use both of them to interact with each other. 
I noticed that each converter can also be realized via a conversion function and output property in the ViewModel class. And sometimes, this may be the way to go, 
as well, because the resulting code may be easier to understand and maintain.</p>
<p>I wanted to show off some more novel Converters than the usual bool to Visibility stuff copied from somewhere else. So, there you go. Please let me know about 
your thoughts and comments on this.</p>
<h2>References</h2>
<p>The article is based on the following resources:</p>
<ul>
<li><a title="CodeProject article by RakeshGunijan" href="http://www.codeproject.com/KB/WPF/MarkupExtensionsConverter.aspx">Converter is based on this CodeProject article By RakeshGunija</a></li>
<li><a title="Article at StackOverflow" href="http://stackoverflow.com/questions/1889966/what-approaches-are-available-to-dummy-design-time-data-in-wpf">Multi-value converter is based on this StackOverflow article</a></li>
<li><a title="Parsing for Memory Sizes (yet another solution off the web)" href="http://rextester.com/rundotnet?code=WMGOQ13650">Conversion logic for units is based on this solution</a></li>
</ul>
<h2>History</h2>
<ul>
<li>12.12.2011: Initial post.</li>
<li>13.12.2011: Updated article to contain a sample on the actual <code>MultiValueConverter</code> binding used in the source code. 
Updated source code to bug fix a problem in the binding of the memory size input value. I wanted to support a floating point value (such as 1.5 GB). 
So I changed the <code>SelectedMemSize</code> property to string and compute the actual size of bytes via a separate property (<code>SelectedMemSizeNumberOfBytes</code>) 
in the <code>ProgramOptionsVM</code> class.</li>
</ul>


						</div>
						

						<div class="float-right" style="margin: 20px 0px 0px 10px; border: 1px solid rgb(204, 204, 204);">
						
						</div>
                        
                        
						
						
						<div id="LicenseTerms"></div>
						

                        
						
				        <div style="margin-bottom: 40px; width: 385px;">
					        
				        </div> 
    			        


						
						
						

<br>
						
						

						<div class="clearfix"></div>

						<div style="padding-top: 8px;">
							
						</div>

						
						
						
					

				    
					</form>

				</div>

				
				

					
					
					
					
				

			</div>
			
		</td>
		<td width="170px">
			
		</td>
		</tr></tbody></table>

		
		

		<div class="extended tiny-text">
			
		</div>
		

		<br clear="all">
		
			

	</div> 
	</div>
</div>


<div style="display: none;" id="dm_AdTable">
	
</div>






<div id="goog-gt-tt" class="skiptranslate" dir="ltr"><div style="padding: 8px;"><div><div class="logo"><img src="translate-32.png" height="20" width="20"></div></div></div><div class="top" style="padding: 8px; float: left; width: 100%;"><h1 class="title gray">Original text</h1></div><div class="middle" style="padding: 8px;"><div class="original-text"></div></div><div class="bottom" style="padding: 8px;"><div class="activity-links"><span class="activity-link">Contribute a better translation</span><span class="activity-link"></span></div><div class="started-activity-container"><hr style="color: rgb(204, 204, 204); background-color: rgb(204, 204, 204); height: 1px; border: medium none;"><div class="activity-root"></div></div></div><div style="display: none;" class="status-message"></div></div>



<iframe src="index_1.html" style="visibility: visible; -moz-box-sizing: content-box; width: 878px; height: 275px; display: none;" class="goog-te-menu-frame skiptranslate" frameborder="0"></iframe>

</body></html>
